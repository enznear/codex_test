<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI App Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-router-dom@5.3.4/umd/react-router-dom.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="static/android-chrome-512x512.png" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#fff7ed',
              100: '#ffedd5',
              500: '#f97316',
              600: '#ea580c',
              700: '#c2410c',
            },
            gray: {
              50: '#f9fafb',
              100: '#f3f4f6',
              200: '#e5e7eb',
              300: '#d1d5db',
              400: '#9ca3af',
              500: '#6b7280',
              600: '#4b5563',
              700: '#374151',
              800: '#1f2937',
              900: '#111827',
            }
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(10px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .status-indicator {
      position: relative;
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }
    .status-running { background-color: #10b981; }
    .status-stopped { background-color: #ef4444; }
    .status-stopping { background-color: #f59e0b; }
    .status-starting { background-color: #3b82f6; }
    .status-indicator.pulse::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
    }
    @keyframes ping {
      75%, 100% {
        transform: scale(2);
        opacity: 0;
      }
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    .upload-area {
      border: 2px dashed #a5b4fc;
      transition: all 0.3s ease;
    }
    .upload-area:hover {
      border-color: #667eea;
      background-color: rgba(102, 126, 234, 0.05);
    }
    .progress-bar {
      background: linear-gradient(90deg, #667eea, #764ba2);
      transition: width 0.3s ease;
    }
   
    /* input:focus,
    textarea:focus,
    select:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    input:focus,
    textarea:focus,
    select:focus {
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    } */    
  </style>
</head>
<body class="font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { BrowserRouter, Switch, Route, Link, useLocation } = ReactRouterDOM;
    
    const nginxBase = window.location.protocol + '//' + window.location.hostname + ':8080';

    const apiFetch = (url, options = {}) => {
      const token = localStorage.getItem('token');
      options.headers = options.headers || {};
      if (token) {
        options.headers['Authorization'] = 'Bearer ' + token;
      }
      return fetch(url, options);
    };

    // 커스텀 드롭다운 컴포넌트
    const CustomSelect = ({ options, value, onChange, placeholder = "Select..." }) => {
      const [isOpen, setIsOpen] = useState(false);
      const [selectedOption, setSelectedOption] = useState(
        options.find(opt => opt.value === value) || null
      );

      const handleSelect = (option) => {
        setSelectedOption(option);
        onChange(option.value);
        setIsOpen(false);
      };

      // 외부 클릭 시 드롭다운 닫기
      useEffect(() => {
        const handleClickOutside = (event) => {
          if (!event.target.closest('.custom-select')) {
            setIsOpen(false);
          }
        };
        document.addEventListener('click', handleClickOutside);
        return () => document.removeEventListener('click', handleClickOutside);
      }, []);

      return (
        <div className="custom-select relative">
          {/* 선택된 값 표시하는 버튼 */}
          <button
            type="button"
            onClick={() => setIsOpen(!isOpen)}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200 bg-white text-left flex items-center justify-between hover:border-gray-400"
          >
            <span className={selectedOption ? "text-gray-900" : "text-gray-500"}>
              {selectedOption ? selectedOption.label : placeholder}
            </span>
            {/* 화살표 아이콘 */}
            <svg 
              className={`w-5 h-5 text-gray-400 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`}
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          {/* 드롭다운 옵션 목록 */}
          {isOpen && (
            <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-xl backdrop-blur-md">
              <div className="py-1 max-h-60 overflow-auto">
                {options.map((option, index) => (
                  <button
                    key={option.value}
                    type="button"
                    onClick={() => handleSelect(option)}
                    className={`w-full px-4 py-3 text-left hover:bg-indigo-50 hover:text-indigo-700 transition-all duration-150 flex items-center ${
                      selectedOption?.value === option.value 
                        ? 'bg-indigo-100 text-indigo-700 font-medium' 
                        : 'text-gray-900'
                    } ${index === 0 ? 'rounded-t-lg' : ''} ${index === options.length - 1 ? 'rounded-b-lg' : ''}`}
                  >
                    <span>{option.label}</span>
                    {selectedOption?.value === option.value && (
                      <svg className="w-4 h-4 ml-auto text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                      </svg>
                    )}
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    };
    
    // Status Badge Component
    const StatusBadge = ({ status }) => {
      const getStatusInfo = (status) => {
        switch (status) {
          case 'running':
            return { class: 'status-running pulse', text: 'Running', bg: 'bg-green-100', text_color: 'text-green-800' };
          case 'stopped':
            return { class: 'status-stopped', text: 'Stopped', bg: 'bg-red-100', text_color: 'text-red-800' };
          case 'stopping':
            return { class: 'status-stopping pulse', text: 'Stopping', bg: 'bg-yellow-100', text_color: 'text-yellow-800' };
          case 'starting':
            return { class: 'status-starting pulse', text: 'Starting', bg: 'bg-blue-100', text_color: 'text-blue-800' };
          case 'building':
            return { class: 'status-starting pulse', text: 'Building', bg: 'bg-blue-100', text_color: 'text-blue-800' };
          default:
            return { class: 'status-stopped', text: 'Unknown', bg: 'bg-gray-100', text_color: 'text-gray-800' };
        }
      };

      const statusInfo = getStatusInfo(status);
      
      return (
        <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusInfo.bg} ${statusInfo.text_color}`}>
          <span className={`status-indicator ${statusInfo.class} mr-1.5`}></span>
          {statusInfo.text}
        </span>
      );
    };

    // Progress Bar Component
    const ProgressBar = ({ progress }) => (
      <div className="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
        <div 
          className="progress-bar h-2 rounded-full" 
          style={{ width: `${progress}%` }}
        ></div>
      </div>
    );

    // Main App Component
    function AppRoutes() {
      const location = useLocation();
      const [token, setToken] = useState(localStorage.getItem('token') || '');
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [name, setName] = useState('');
      const [description, setDescription] = useState('');
      const [runType, setRunType] = useState('gradio');
      const [vramRequired, setVramRequired] = useState('0');
      const [files, setFiles] = useState([]);
      const [apps, setApps] = useState([]);
      const [logs, setLogs] = useState({});
      const [showLogs, setShowLogs] = useState({});
      const [uploadMsg, setUploadMsg] = useState('');
      const [uploadProgress, setUploadProgress] = useState(0);
      const [templates, setTemplates] = useState([]);
      const [editId, setEditId] = useState(null);
      const [editName, setEditName] = useState('');
      const [editDesc, setEditDesc] = useState('');
      const [tEditId, setTEditId] = useState(null);
      const [tEditName, setTEditName] = useState('');
      const [tEditDesc, setTEditDesc] = useState('');
      const [tEditVram, setTEditVram] = useState('0');
      const [openMenus, setOpenMenus] = useState({});
      const [mode, setMode] = useState('login');
      // Close any open kebab menus when clicking outside
      useEffect(() => {
        const handleClickOutside = () => setOpenMenus({});
        document.addEventListener('click', handleClickOutside);
        return () => document.removeEventListener('click', handleClickOutside);
      }, []);

      if (!token) {
        const handleLogin = (e) => {
          e.preventDefault();
          apiFetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ username, password })
          })
            .then(res => res.json())
            .then(data => {
              if (data.access_token) {
                localStorage.setItem('token', data.access_token);
                setToken(data.access_token);
              } else {
                alert('Login failed');
              }
            })
            .catch(() => alert('Login failed'));
        };

        const handleRegister = (e) => {
          e.preventDefault();
          apiFetch('/register', {
            method: 'POST',
            body: new URLSearchParams({ username, password })
          })
            .then(res => {
              if (res.ok) {
                alert('User created');
                setMode('login');
              } else {
                alert('Registration failed');
              }
            })
            .catch(() => alert('Registration failed'));
        };

        if (mode === 'register') {
          return (
            <div className="min-h-screen flex items-center justify-center bg-gray-100">
              <form onSubmit={handleRegister} className="bg-white p-6 rounded-lg shadow space-y-4">
                <h2 className="text-xl font-semibold text-gray-900">Register</h2>
                <input type="text" className="w-full border rounded p-2" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} />
                <input type="password" className="w-full border rounded p-2" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} />
                <button type="submit" className="btn-primary text-white w-full py-2 rounded">Register</button>
                <p className="text-sm text-center"><a href="#" onClick={() => setMode('login')} className="text-blue-600">Back to login</a></p>
              </form>
            </div>
          );
        }


        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-100">
            <form onSubmit={handleLogin} className="bg-white p-6 rounded-lg shadow space-y-4">
              <h2 className="text-xl font-semibold text-gray-900">Login</h2>
              <input type="text" className="w-full border rounded p-2" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} />
              <input type="password" className="w-full border rounded p-2" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} />
              <button type="submit" className="btn-primary text-white w-full py-2 rounded">Login</button>
              <p className="text-sm text-center"><a href="#" onClick={() => setMode('register')} className="text-blue-600">Register</a></p>
            </form>
          </div>
        );
      }


      useEffect(() => {
        apiFetch('/status')
          .then(res => res.json())
          .then(data => setApps(data))
          .catch(() => {});
        apiFetch('/templates')
          .then(res => res.json())
          .then(data => setTemplates(data))
          .catch(() => {});
      }, []);

      const refreshStatus = () => {
        apiFetch('/status')
          .then(res => res.json())
          .then(data => setApps(data));
      };

      const pollStatus = (appId) => {
        const interval = setInterval(() => {
          apiFetch('/status')
            .then(res => res.json())
            .then(data => {
              setApps(data);
              const app = data.find(a => a.id === appId);
              if (!app || app.status !== 'stopping') {
                clearInterval(interval);
              }
            })
            .catch(() => {});
        }, 2000);
      };

      useEffect(() => {
        const interval = setInterval(refreshStatus, 2000);
        return () => clearInterval(interval);
      }, []);

      const handleUpload = (e) => {
        e.preventDefault();
        if (files.length === 0) return;
        if (files.length > 1) {
          alert('Multiple files selected. Only the first file will be uploaded. Bundle files into a zip to upload them all.');
        }
        const formData = new FormData();
        formData.append('name', name);
        formData.append('description', description);
        formData.append('file', files[0]);
        formData.append('vram_required', vramRequired);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/upload');
        const t = localStorage.getItem('token');
        if (t) {
          xhr.setRequestHeader('Authorization', 'Bearer ' + t);
        }
        setUploadMsg('Upload started');
        xhr.upload.onprogress = (event) => {
          if (event.lengthComputable) {
            setUploadProgress(Math.round((event.loaded / event.total) * 100));
          }
        };
        xhr.onload = () => {
          let data = {};
          try { data = JSON.parse(xhr.responseText); } catch (e) {}
          setUploadProgress(0);
          if (xhr.status >= 200 && xhr.status < 300) {
            setUploadMsg('Upload finished: ' + (data.app_id || ''));
            setName('');
            setDescription('');
            setRunType('gradio');
            setVramRequired('0');
            setFiles([]);
            refreshStatus();
          } else {
            setUploadMsg('Error: ' + (data.detail || 'upload failed'));
          }
        };
        xhr.onerror = () => {
          setUploadMsg('Error uploading app.');
          setUploadProgress(0);
        };
        xhr.send(formData);
      };

      const toggleLogs = (appId) => {
        if (showLogs[appId]) {
          setShowLogs(prev => ({ ...prev, [appId]: false }));
          return;
        }
        apiFetch(`/logs/${appId}`)
          .then(res => res.text())
          .then(text => {
            setLogs(prev => ({ ...prev, [appId]: text }));
            setShowLogs(prev => ({ ...prev, [appId]: true }));
          })
          .catch(() => {
            setLogs(prev => ({ ...prev, [appId]: 'Failed to load logs.' }));
            setShowLogs(prev => ({ ...prev, [appId]: true }));
        });
      };

      const toggleMenu = (appId) => {
        setOpenMenus(prev => ({ ...prev, [appId]: !prev[appId] }));
      };

      const closeMenu = (appId) => {
        setOpenMenus(prev => ({ ...prev, [appId]: false }));
      };

      const stopApp = (id) => {
        apiFetch(`/stop/${id}`, { method: 'POST' })
          .then(() => {
            refreshStatus();
            pollStatus(id);
          })
          .catch(() => {});
      };

      const restartApp = (id) => {
        apiFetch(`/restart/${id}`, { method: 'POST' })
          .then(() => refreshStatus())
          .catch(() => {});
      };

      const deleteApp = (id) => {
        if (!confirm('Delete this app?')) return;
        apiFetch(`/apps/${id}`, { method: 'DELETE' })
          .then(() => {
            refreshStatus();
            setLogs(prev => { const n = { ...prev }; delete n[id]; return n; });
          })
          .catch(() => {});
      };

      const deployTemplate = (id) => {
        apiFetch(`/deploy_template/${id}`, { method: 'POST' })
          .then(() => refreshStatus())
          .catch(() => {});
      };

      const saveTemplate = (id) => {
        apiFetch(`/save_template/${id}`, { method: 'POST' })
          .then(() => {
            apiFetch('/templates')
              .then(res => res.json())
              .then(data => setTemplates(data));
          })
          .catch(() => {});
      };

      const deleteTemplate = (id) => {
        if (!confirm('Delete this template?')) return;
        apiFetch(`/templates/${id}`, { method: 'DELETE' })
          .then(() => {
            apiFetch('/templates')
              .then(res => res.json())
              .then(data => setTemplates(data));
          })
          .catch(() => {});
      };

      const startTemplateEdit = (t) => {
        setTEditId(t.id);
        setTEditName(t.name || '');
        setTEditDesc(t.description || '');
        setTEditVram(String(t.vram_required || 0));
      };

      const cancelTemplateEdit = () => {
        setTEditId(null);
        setTEditName('');
        setTEditDesc('');
        setTEditVram('0');
      };

      const saveTemplateEdit = () => {
        apiFetch('/edit_template', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            template_id: tEditId,
            name: tEditName,
            description: tEditDesc,
            vram_required: parseInt(tEditVram, 10) || 0
          })
        }).then(() => {
          apiFetch('/templates')
            .then(res => res.json())
            .then(data => setTemplates(data));
          cancelTemplateEdit();
        }).catch(() => {});
      };

      const startEdit = (app) => {
        setEditId(app.id);
        setEditName(app.name || '');
        setEditDesc(app.description || '');
      };

      const cancelEdit = () => {
        setEditId(null);
        setEditName('');
        setEditDesc('');
      };

      const saveEdit = () => {
        apiFetch('/edit_app', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ app_id: editId, name: editName, description: editDesc })
        }).then(() => {
          refreshStatus();
          cancelEdit();
        }).catch(() => {});
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
          {/* Header */}
          <header className="bg-white/80 backdrop-blur-md border-b border-gray-200/50 sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex justify-between items-center py-6">
                <div className="flex items-center space-x-3">
                  <div className="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <span className="text-white font-bold text-sm">AI</span>
                  </div>
                  <h1 className="text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">
                    AI App Portal
                  </h1>
                </div>
                
                <nav className="flex space-x-1 bg-gray-100 rounded-lg p-1">
                  <Link
                    to="/"
                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ${
                      location.pathname === '/'
                        ? 'bg-white text-gray-900 shadow-sm'
                        : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    Create App
                  </Link>
                  <Link
                    to="/apps"
                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ${
                      location.pathname === '/apps'
                        ? 'bg-white text-gray-900 shadow-sm'
                        : 'text-gray-600 hover:text-gray-900'
                    }`}
                  >
                    My Apps ({apps.length})
                  </Link>
                  <button
                    onClick={() => { localStorage.removeItem('token'); setToken(''); }}
                    className="px-4 py-2 rounded-md text-sm font-medium text-gray-600 hover:text-gray-900"
                  >
                    Logout
                  </button>
                </nav>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <Switch>
              <Route exact path="/">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                  {/* Upload Form */}
                  <div className="space-y-6">
                    <div className="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-8 card-hover">
                      <div className="flex items-center space-x-3 mb-6">
                        <div className="w-10 h-10 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                          <span className="text-white text-lg">+</span>
                        </div>
                        <h2 className="text-xl font-semibold text-gray-900">Deploy New App</h2>
                      </div>
                      
                      <form onSubmit={handleUpload} className="space-y-6">
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">App Name</label>
                          <input 
                            type="text" 
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                            placeholder="My Awesome AI App" 
                            value={name} 
                            onChange={e => setName(e.target.value)} 
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Description</label>
                          <textarea 
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                            placeholder="Brief description of your app..." 
                            rows="3"
                            value={description} 
                            onChange={e => setDescription(e.target.value)} 
                          />
                        </div>
                        
                        <div className="grid grid-cols-2 gap-4">
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Runtime</label>
                            <CustomSelect
                              options={[
                                { value: 'gradio', label: 'Gradio' },
                                { value: 'docker', label: 'Docker' }
                              ]}
                              value={runType}
                              onChange={(value) => setRunType(value)}
                              placeholder="Select runtime..."
                            />                            
                          </div>
                          
                          <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">VRAM (MB)</label>
                            <input 
                              type="number" 
                              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                              placeholder="0" 
                              value={vramRequired} 
                              onChange={e => setVramRequired(e.target.value)} 
                            />
                          </div>
                        </div>
                        
                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Upload Files</label>
                          <div className="upload-area border-2 border-dashed border-indigo-300 rounded-lg p-6 text-center">
                            <input 
                              type="file" 
                              className="hidden" 
                              id="file-upload"
                              onChange={e => setFiles(e.target.files)} 
                              multiple 
                            />
                            <label htmlFor="file-upload" className="cursor-pointer">
                              <div className="text-gray-400 mb-2">
                                <svg className="mx-auto h-12 w-12" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                  <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" />
                                </svg>
                              </div>
                              <p className="text-sm text-gray-600">
                                Click to upload or drag and drop
                              </p>
                              <p className="text-xs text-gray-400 mt-1">
                                ZIP, PY, or any project files
                              </p>
                            </label>
                            {files.length > 0 && (
                              <p className="mt-2 text-sm text-indigo-600 font-medium">
                                {files.length} file(s) selected
                              </p>
                            )}
                          </div>
                        </div>
                        
                        <button 
                          type="submit" 
                          className="w-full btn-primary text-white py-3 px-6 rounded-lg font-medium shadow-lg"
                        >
                          Deploy App
                        </button>
                      </form>
                      
                      {uploadProgress > 0 && uploadProgress < 100 && (
                        <div className="mt-4">
                          <div className="flex justify-between text-sm text-gray-600 mb-2">
                            <span>Uploading...</span>
                            <span>{uploadProgress}%</span>
                          </div>
                          <ProgressBar progress={uploadProgress} />
                        </div>
                      )}
                      
                      {uploadMsg && (
                        <div className={`mt-4 p-3 rounded-lg text-sm ${
                          uploadMsg.includes('Error') 
                            ? 'bg-red-50 text-red-700 border border-red-200' 
                            : 'bg-green-50 text-green-700 border border-green-200'
                        }`}>
                          {uploadMsg}
                        </div>
                      )}
                    </div>
                  </div>
                  
                  {/* Templates */}
                  <div className="space-y-6">
                    <div className="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-8 card-hover">
                      <div className="flex items-center space-x-3 mb-6">
                        <div className="w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-lg flex items-center justify-center">
                          <span className="text-white text-lg">⚡</span>
                        </div>
                        <h2 className="text-xl font-semibold text-gray-900">Quick Deploy Templates</h2>
                      </div>
                      
                      <div className="space-y-4 max-h-96 overflow-y-auto">
                        {templates.length === 0 ? (
                          <div className="text-center py-8 text-gray-500">
                            <p>No templates available yet.</p>
                            <p className="text-sm mt-1">Deploy an app first, then save it as a template!</p>
                          </div>
                        ) : (
                          templates.map(t => (
                            <div key={t.id} className="border border-gray-200 rounded-lg p-4 hover:border-indigo-300 transition-all duration-200">
                              {tEditId === t.id ? (
                                <div className="space-y-3">
                                  <div className="space-y-1">
                                    <label className="text-sm text-gray-700">Name</label>
                                    <input
                                      type="text"
                                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                                      placeholder="Template Name"
                                      value={tEditName}
                                      onChange={e => setTEditName(e.target.value)}
                                    />
                                  </div>
                                  <div className="space-y-1">
                                    <label className="text-sm text-gray-700">Description</label>
                                    <textarea
                                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                                      placeholder="Description"
                                      rows="2"
                                      value={tEditDesc}
                                      onChange={e => setTEditDesc(e.target.value)}
                                    />
                                  </div>
                                  <div className="space-y-1">
                                    <label className="text-sm text-gray-700">VRAM (MB)</label>
                                    <input
                                      type="number"
                                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                                      placeholder="VRAM (MB)"
                                      value={tEditVram}
                                      onChange={e => setTEditVram(e.target.value)}
                                    />
                                  </div>
                                  <div className="flex space-x-2">
                                    <button 
                                      onClick={saveTemplateEdit} 
                                      className="btn-primary text-white px-3 py-1.5 rounded-md text-sm font-medium"
                                    >
                                      Save
                                    </button>
                                    <button 
                                      onClick={cancelTemplateEdit} 
                                      className="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors"
                                    >
                                      Cancel
                                    </button>
                                  </div>
                                </div>
                              ) : (
                                <>
                                  <div className="flex justify-between items-start mb-3">
                                    <div>
                                      <h3 className="font-medium text-gray-900">{t.name}</h3>
                                      <p className="text-sm text-gray-600 mt-1">{t.description}</p>
                                      <div className="flex items-center space-x-4 mt-2 text-xs text-gray-500">
                                        <span>Type: {t.type}</span>
                                        <span>VRAM: {t.vram_required} MB</span>
                                      </div>
                                    </div>
                                  </div>
                                  <div className="flex space-x-2">
                                    <button 
                                      onClick={() => deployTemplate(t.id)} 
                                      className="btn-primary text-white px-3 py-1.5 rounded-md text-sm font-medium flex-1"
                                    >
                                      Deploy
                                    </button>
                                    <button 
                                      onClick={() => startTemplateEdit(t)} 
                                      className="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors"
                                    >
                                      Edit
                                    </button>
                                    <button 
                                      onClick={() => deleteTemplate(t.id)} 
                                      className="bg-red-50 text-red-700 px-3 py-1.5 rounded-md text-sm font-medium hover:bg-red-100 transition-colors"
                                    >
                                      Delete
                                    </button>
                                  </div>
                                </>
                              )}
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  </div>
                </div>
              </Route>
              
              <Route path="/apps">
                <div className="space-y-6">
                  <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-gray-900 mb-2">Your AI Applications</h2>
                    <p className="text-gray-600">Manage and monitor your deployed applications</p>
                  </div>
                  
                  {apps.length === 0 ? (
                    <div className="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-12 text-center">
                      <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span className="text-2xl text-gray-400">📱</span>
                      </div>
                      <h3 className="text-xl font-semibold text-gray-900 mb-2">No apps deployed yet</h3>
                      <p className="text-gray-600 mb-6">Get started by creating your first AI application</p>
                      <Link 
                        to="/" 
                        className="btn-primary text-white px-6 py-3 rounded-lg font-medium inline-block"
                      >
                        Create Your First App
                      </Link>
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                      {apps.map(app => (
                        <div
                          key={app.id}
                          className="bg-white rounded-2xl shadow-xl border border-gray-200/50 p-6 card-hover cursor-pointer relative overflow-hidden"
                          onClick={() => app.url && window.open(`${nginxBase}${app.url}`, '_blank')}
                        >
                          {/* Status indicator overlay with actions */}
                          <div className="absolute top-4 right-4 flex items-center space-x-2 z-10" onClick={e => e.stopPropagation()}>
                            <StatusBadge status={app.status} />
                            <div className="relative">
                              <button
                                onClick={e => { e.stopPropagation(); toggleMenu(app.id); }}
                                className="w-8 h-8 flex items-center justify-center rounded hover:bg-gray-100"
                              >
                                ⋯

                              </button>
                              {openMenus[app.id] && (
                                <div className="absolute right-0 mt-2 w-32 bg-white border rounded shadow-lg">
                                  <button onClick={() => { toggleLogs(app.id); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100">
                                    {showLogs[app.id] ? 'Hide Logs' : 'Logs'}
                                  </button>
                                  <button onClick={() => { startEdit(app); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100">
                                    Edit
                                  </button>
                                  {app.status === 'running' ? (
                                    <button onClick={() => { stopApp(app.id); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100">
                                      Stop
                                    </button>
                                  ) : (
                                    <button onClick={() => { restartApp(app.id); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100">
                                      Start
                                    </button>
                                  )}
                                  <button onClick={() => { saveTemplate(app.id); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100">
                                    Template
                                  </button>
                                  <button onClick={() => { deleteApp(app.id); closeMenu(app.id); }} className="block w-full text-left px-3 py-2 text-sm hover:bg-gray-100 text-red-600">
                                    Delete App
                                  </button>
                                </div>
                              )}
                            </div>
                          </div>
                          
                          <div className="mb-4">
                            <div className="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center mb-3">
                              <span className="text-white font-bold">
                                {(app.name || app.id).charAt(0).toUpperCase()}
                              </span>
                            </div>
                            
                            <h3 className="text-xl font-semibold text-gray-900 mb-1 pr-20">
                              {app.name || app.id}
                            </h3>
                            <p className="text-xs text-gray-500 font-mono">ID: {app.id}</p>
                            
                            {app.description && (
                              <p className="text-sm text-gray-600 mt-2 line-clamp-2">
                                {app.description}
                              </p>
                            )}
                            
                            {app.gpu !== null && app.gpu !== undefined && (
                              <div className="mt-3 flex items-center space-x-2">
                                <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                  🎮 GPU {app.gpu}
                                </span>
                              </div>
                            )}
                          </div>
                          
                          {editId === app.id ? (
                            <div className="space-y-3 mt-4" onClick={e => e.stopPropagation()}>
                              <div className="space-y-1">
                                <label className="text-sm text-gray-700">Name</label>
                                <input
                                  type="text"
                                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                                  placeholder="App Name"
                                  value={editName}
                                  onChange={e => setEditName(e.target.value)}
                                />
                              </div>
                              <div className="space-y-1">
                                <label className="text-sm text-gray-700">Description</label>
                                <textarea
                                  className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-indigo-600 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition-all duration-200"
                                  placeholder="Description"
                                  rows="2"
                                  value={editDesc}
                                  onChange={e => setEditDesc(e.target.value)}
                                />
                              </div>
                              <div className="flex space-x-2">
                                <button
                                  onClick={saveEdit}
                                  className="btn-primary text-white px-3 py-1.5 rounded-md text-sm font-medium flex-1"
                                >
                                  Save
                                </button>
                                <button
                                  onClick={cancelEdit}
                                  className="bg-gray-100 text-gray-700 px-3 py-1.5 rounded-md text-sm font-medium"
                                >
                                  Cancel
                                </button>
                              </div>
                            </div>
                          ) : (
                            <></>
                          )}
                          
                          {/* Logs panel */}
                          {showLogs[app.id] && (
                            <div className="mt-4 border-t border-gray-200 pt-4" onClick={e => e.stopPropagation()}>
                              <div className="bg-gray-900 rounded-lg p-4 max-h-48 overflow-auto">
                                <pre className="text-green-400 text-xs font-mono whitespace-pre-wrap">
                                  {logs[app.id] || 'Loading logs...'}
                                </pre>
                              </div>
                            </div>
                          )}
                          
                          {/* Click indicator */}
                          {app.url && app.status === 'running' && (
                            <div className="absolute bottom-1 left-6 text-xs text-gray-400">
                              Click to open app →
                            </div>
                          )}
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </Route>
            </Switch>
          </main>
          
          {/* Footer */}
          <footer className="bg-white/50 backdrop-blur-md border-t border-gray-200/50 mt-16">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
              <div className="text-center text-gray-600">
                <p className="text-sm">
                  AI App Portal - Deploy and manage your AI applications with ease
                </p>
                <p className="text-xs mt-2 text-gray-400">
                  Built with modern web technologies for optimal performance
                </p>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    function App() {
      return (
        <BrowserRouter>
          <AppRoutes />
        </BrowserRouter>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>